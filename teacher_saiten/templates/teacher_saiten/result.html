{% extends "teacher/base.html" %}

{% block modorulink %}<a href="{{ url_for('teacher.teisyutsu.t_teisyutsu') }}">戻る</a>{% endblock %}

{% block content %}
    {% for p in personal_lst %}
    <h2>{{p.Student.student_name}}({{p.Student.id}})</h2>
    {% if p.Personal_Submission.submitted %}
        {% if jupyter %}
            <h3>jupyter</h3>
            <table>
                <tr>
                    <th>入力</th>
                    <th>標準出力</th>
                    <th>実行結果</th>
                    <th>正誤</th>
                </tr>
                {% for o in jupyter[p.Student.id]['result'] %}
                <tr>
                    <td>
                        {% for input in o['input'] %}
                            {{input}}<br>
                        {% endfor %}
                    </td>
                    <td>
                        {% for output in o['output'] %}
                            {{output}}<br>
                        {% endfor %}
                    </td>
                    <td>
                        {% for ans in o['ans'] %}
                        
                            {{ans}}<br>
                        {% endfor %}
                    </td>
                    <td>
                        {% if o['ox'] %}
                        〇
                        {% else %}
                        ×
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </table>
            <p>{{jupyter[p.Student.id]['point']}}点</p>
        {% endif %}

        {% if gemini %}
            <h3>gemini</h3>
            <p>{{ gemini[p.Student.id]['result'] }}点</p>
        {% endif %}
        <div class="field">
            <input class="hidden" type="hidden" value="{{p.Student.id}}">
            <input class="number" type="number" value="{{points[p.Student.id]}}" min="0" max="100">
        </div>
        <div>
            <h3>コード</h3>
            {% for code in codes[p.Student.id] %}
                {{code}}<br>
            {% endfor %}
        </div>
    {% else %}
        <p>未提出</p>
    {% endif %}
    {% endfor %}
<form action="{{ url_for('teacher.saiten.auto') }}" method="POST">
    {{ form.csrf_token }}
    <textarea style="display:none" id="fieldlist" name="fieldlist" readonly></textarea>
    {{ form.submit }}
</form>
<script>
    var hiddenElm = document.getElementsByClassName("hidden");
    var numberElm = document.getElementsByClassName("number");
    var listElm = document.getElementById("fieldlist");
    var firstpoint = "";
    for (let i = 0; i < hiddenElm.length; i++){
        firstpoint += hiddenElm[i].value + "\n" + numberElm[i].value + "\n";
        hiddenElm[i].addEventListener("change", function(){inputChange(hiddenElm, numberElm)});
        numberElm[i].addEventListener("change", function(){inputChange(hiddenElm, numberElm)});
    }
    listElm.value = firstpoint;

    function inputChange(hiddenElm, numberElm){
        var point = "";
        for (let i = 0; i < hiddenElm.length; i++){
            if (numberElm[i].value > 100) {numberElm[i].value = 100;}
            if (numberElm[i].value < 0) {numberElm[i].value = 0;}
            point += hiddenElm[i].value + "\n" + numberElm[i].value + "\n";
        }
        listElm.value = point;
    }
</script>
{% endblock %}