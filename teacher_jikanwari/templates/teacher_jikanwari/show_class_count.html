{% extends "teacher/base.html" %}

{% block title %}授業数登録{% endblock %}
{% block h1 %}授業数登録{% endblock %}
{% block modorulink %}{{ url_for('teacher.jikanwari.class_list') }}{% endblock %}

{% block content %}
    {% if error_message %}
    <p style="color: red;">{{ error_message }}</p>
    {% endif %}

    <form method="POST" action="{{ url_for('teacher.jikanwari.show_class_count') }}">
        <table>
            <thead>
                <tr>
                    <th>授業科目</th>
                    <th>コマ数</th>
                    <th>単位数</th>
                </tr>
            </thead>
            <tbody>
                {% for subject in subjects %}
                <tr>
                    <td>{{ subject.subject_name }}</td>
                    <td>
                        <select name="periods_{{ subject.subject_id }}" 
                                onchange="updateUnitsAndPeriods('{{ subject.subject_id }}', 'periods')" 
                                required>
                            <option value="">選択してください</option>
                            {% for i in range(1, 11) %}
                            <option value="{{ i * 15 }}"
                                    {% if subject_details[subject.subject_name] 
                                       and subject_details[subject.subject_name].periods == i * 15 %} 
                                    selected 
                                    {% endif %}>
                                {{ i * 15 }} コマ
                            </option>
                            {% endfor %}
                        </select>
                    </td>
                    <td>
                        <select name="units_{{ subject.subject_id }}" 
                                onchange="updateUnitsAndPeriods('{{ subject.subject_id }}', 'units')" 
                                required>
                            <option value="">選択してください</option>
                            {% for i in range(1, 11) %}
                            <option value="{{ i }}"
                                    {% if subject_details[subject.subject_name] 
                                       and subject_details[subject.subject_name].units == i %} 
                                    selected 
                                    {% endif %}>
                                {{ i }} 単位
                            </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit">確認</button>
    </form>
    
    <script>
        // コマ数と単位数の双方向更新を行うスクリプト
        function updateUnitsAndPeriods(subjectId, changedField) {
            const periodsSelect = document.querySelector(`select[name="periods_${subjectId}"]`);
            const unitsSelect = document.querySelector(`select[name="units_${subjectId}"]`);

            if (changedField === 'periods') {
                const selectedPeriods = parseInt(periodsSelect.value, 10);
                if (selectedPeriods) {
                    const calculatedUnits = selectedPeriods / 15; // 15コマ = 1単位の計算
                    unitsSelect.value = calculatedUnits; // 単位数を更新
                } else {
                    unitsSelect.value = ""; // 初期状態にリセット
                }
            } else if (changedField === 'units') {
                const selectedUnits = parseInt(unitsSelect.value, 10);
                if (selectedUnits) {
                    const calculatedPeriods = selectedUnits * 15; // 1単位 = 15コマの計算
                    periodsSelect.value = calculatedPeriods; // コマ数を更新
                } else {
                    periodsSelect.value = ""; // 初期状態にリセット
                }
            }
        }
    </script>
{% endblock %}
