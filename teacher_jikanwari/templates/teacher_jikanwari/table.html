{% extends "teacher/base.html" %}

{% block title %}時間割表{% endblock %}
{% block modorulink %}<a href="{{ url_for('teacher.menu.t_menu') }}">戻る</a>{% endblock %}
{% block content %}
<h1>時間割表</h1>
<link rel="stylesheet" href="/static/css/stylecss.css">

<!-- ボタンを右上に配置 -->
<div style="text-align: right; margin-bottom: 20px;">
    <!-- 授業数登録ボタン -->
    <a href="{{ url_for('teacher.jikanwari.class_list') }}" class="button">授業数登録</a>
    <!-- 編集ボタン -->
    <a href="{{ url_for('teacher.jikanwari.add_entry') }}" class="button">編集</a>
</div>

<!-- 年と月の選択 -->
<form action="{{ url_for('teacher.jikanwari.t_jikanwari') }}" method="POST" id="add-entry-form">
    <label for="year-select">年</label>
    <select name="year" id="year-select">
        <option value="2024" {% if selected_year == 2024 %}selected{% endif %}>2024</option>
        <option value="2025" {% if selected_year == 2025 %}selected{% endif %}>2025</option>
        <!-- 必要に応じて追加 -->
    </select>

    <label for="month-select">月</label>
    <select name="month" id="month-select">
        <option value="1" {% if selected_month == 1 %}selected{% endif %}>1月</option>
        <option value="2" {% if selected_month == 2 %}selected{% endif %}>2月</option>
        <option value="3" {% if selected_month == 3 %}selected{% endif %}>3月</option>
        <option value="4" {% if selected_month == 4 %}selected{% endif %}>4月</option>
        <option value="5" {% if selected_month == 5 %}selected{% endif %}>5月</option>
        <option value="6" {% if selected_month == 6 %}selected{% endif %}>6月</option>
        <option value="7" {% if selected_month == 7 %}selected{% endif %}>7月</option>
        <option value="8" {% if selected_month == 8 %}selected{% endif %}>8月</option>
        <option value="9" {% if selected_month == 9 %}selected{% endif %}>9月</option>
        <option value="10" {% if selected_month == 10 %}selected{% endif %}>10月</option>
        <option value="11" {% if selected_month == 11 %}selected{% endif %}>11月</option>
        <option value="12" {% if selected_month == 12 %}selected{% endif %}>12月</option>
    </select>
</form>

<!-- 選択された年と月を表示する部分 -->
<div style="text-align: center; margin-top: 20px;">
    <h2 id="selected-month">2024年1月</h2> <!-- 初期表示 -->
</div>

<!-- カレンダー表示 -->
<table class="jikanwari-table" id="calendar-table">
    <thead>
        <tr class="jikanwari-tr">
            <th class="jikanwari-th">年</th> <!-- 年の列 -->
            <th class="jikanwari-th">月</th> <!-- 月の列 -->
            <th class="jikanwari-th">日</th>
            <th class="jikanwari-th">曜日</th>
            <th class="jikanwari-th">1時間目</th>
            <th class="jikanwari-th">2時間目</th>
            <th class="jikanwari-th">3時間目</th>
            <th class="jikanwari-th">備考</th>
            <th class="jikanwari-th">イベント</th>
        </tr>
    </thead>
    <!-- <tbody id="calendar-body"> -->
        <!-- ここにJavaScriptで日付と曜日が表示される -->
    <!-- </tbody> -->
     <!-- <tbody> -->
        {% for entry in entries %}
        <tr>
        <th class="jikanwari-td">{{ entry.year }}</th> <!-- 年の列 -->
        <th class="jikanwari-td">{{ entry.month }}</th> <!-- 月の列 -->
        <th class="jikanwari-td">{{ entry.day }}</th>
        <th class="jikanwari-td">{{ entry.weekday }}</th>
        <th class="jikanwari-td">{{ entry.period1 }}</th>
        <th class="jikanwari-td">{{ entry.period2 }}</th>
        <th class="jikanwari-td">{{ entry.period3 }}</th>
        <th class="jikanwari-td">{{ entry.note }}</th>
        <th class="jikanwari-td">{{ entry.event }}</th>
        </tr>
        {% endfor %}
     <!-- </tbody> -->
</table>

<script>
    // 月ごとの日数を取得する関数
    function getDaysInMonth(year, month) {
        return new Date(year, month, 0).getDate(); // 月の最後の日付を取得
    }

    // 曜日を取得する関数
    function getWeekday(day, year, month) {
        const date = new Date(year, month - 1, day); // JavaScriptでは月が0から始まる
        const weekdays = ['月', '火', '水', '木', '金', '土', '日'];
        return weekdays[date.getDay()]; // 0=日曜日, 6=土曜日
    }

    // 選択された年と月に基づいてカレンダーを更新
    function updateCalendar(year, month) {
        const numberOfDays = getDaysInMonth(year, month);
        const calendarBody = document.getElementById('calendar-body');
        calendarBody.innerHTML = ''; // 既存のテーブル行をクリア

        for (let day = 1; day <= numberOfDays; day++) {
            const weekday = getWeekday(day, year, month);
            const row = document.createElement('tr');
            row.classList.add('jikanwari-tr');

            const yearCell = document.createElement('td');
            yearCell.classList.add('jikanwari-td');
            yearCell.textContent = year; // 年を表示

            const monthCell = document.createElement('td');
            monthCell.classList.add('jikanwari-td');
            monthCell.textContent = month; // 月を表示

            const dayCell = document.createElement('td');
            dayCell.classList.add('jikanwari-td');
            dayCell.textContent = day;

            const weekdayCell = document.createElement('td');
            weekdayCell.classList.add('jikanwari-td');
            weekdayCell.textContent = weekday;

            // 入力フォームを削除
            const period1Cell = document.createElement('td');
            period1Cell.classList.add('jikanwari-td');
            period1Cell.textContent = ''; // 空のセル

            const period2Cell = document.createElement('td');
            period2Cell.classList.add('jikanwari-td');
            period2Cell.textContent = ''; // 空のセル

            const period3Cell = document.createElement('td');
            period3Cell.classList.add('jikanwari-td');
            period3Cell.textContent = ''; // 空のセル

            const notesCell = document.createElement('td');
            notesCell.classList.add('jikanwari-td');
            notesCell.textContent = ''; // 空のセル

            const eventCell = document.createElement('td');
            eventCell.classList.add('jikanwari-td');
            eventCell.textContent = ''; // 空のセル

            // 行に追加
            row.appendChild(yearCell);
            row.appendChild(monthCell);
            row.appendChild(dayCell);
            row.appendChild(weekdayCell);
            row.appendChild(period1Cell);
            row.appendChild(period2Cell);
            row.appendChild(period3Cell);
            row.appendChild(notesCell);
            row.appendChild(eventCell);

            calendarBody.appendChild(row);
        }

        // 年月を上部に表示
        const monthTitle = document.getElementById('selected-month');
        monthTitle.textContent = `${year}年${month}月`;
    }

    // ページが読み込まれた時に、現在の選択を反映してカレンダーを更新
    document.addEventListener('DOMContentLoaded', function () {
        const yearSelect = document.getElementById('year-select');
        const monthSelect = document.getElementById('month-select');
        
        let year = yearSelect.value;
        let month = monthSelect.value;

        updateCalendar(year, month);

        // 年月が変更された時にカレンダーを更新
        yearSelect.addEventListener('change', function () {
            year = yearSelect.value;
            updateCalendar(year, month);
        });

        monthSelect.addEventListener('change', function () {
            month = monthSelect.value;
            updateCalendar(year, month);
        });
    });
</script>

{% endblock %}
