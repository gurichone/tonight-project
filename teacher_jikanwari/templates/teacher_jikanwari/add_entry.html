{% extends "teacher/base.html" %}

{% block title %}授業の追加{% endblock %}

{% block modorulink %}
    <a href="{{ url_for('teacher.jikanwari.t_jikanwari') }}">戻る</a>
{% endblock %}

{% block content %}
    <h1>授業の追加</h1>

    <!-- 年と月の選択 -->
    <form method="POST" action="{{ url_for('jikanwari.save_timetable') }}">
        <label for="year-select">年</label>
        <select name="year" id="year-select" onchange="this.form.submit()">
            <option value="2024" {% if selected_year == 2024 %}selected{% endif %}>2024</option>
            <option value="2025" {% if selected_year == 2025 %}selected{% endif %}>2025</option>
        </select>
    
        <label for="month-select">月</label>
        <select name="month" id="month-select" onchange="this.form.submit()">
            <option value="1" {% if selected_month == 1 %}selected{% endif %}>1月</option>
            <option value="2" {% if selected_month == 2 %}selected{% endif %}>2月</option>
            <option value="3" {% if selected_month == 3 %}selected{% endif %}>3月</option>
            <option value="4" {% if selected_month == 4 %}selected{% endif %}>4月</option>
            <option value="5" {% if selected_month == 5 %}selected{% endif %}>5月</option>
            <option value="6" {% if selected_month == 6 %}selected{% endif %}>6月</option>
            <option value="7" {% if selected_month == 7 %}selected{% endif %}>7月</option>
            <option value="8" {% if selected_month == 8 %}selected{% endif %}>8月</option>
            <option value="9" {% if selected_month == 9 %}selected{% endif %}>9月</option>
            <option value="10" {% if selected_month == 10 %}selected{% endif %}>10月</option>
            <option value="11" {% if selected_month == 11 %}selected{% endif %}>11月</option>
            <option value="12" {% if selected_month == 12 %}selected{% endif %}>12月</option>
        </select>
    </form>
    
    <!-- データの保存フォーム -->
    <form method="POST" action="{{ url_for('teacher.jikanwari.save_entries') }}">
        <table class="jikanwari-table" id="calendar-table">
            <thead>
                <tr class="jikanwari-tr">
                    <th class="jikanwari-th">年</th>
                    <th class="jikanwari-th">月</th>
                    <th class="jikanwari-th">日</th>
                    <th class="jikanwari-th">曜日</th>
                    <th class="jikanwari-th">1時間目</th>
                    <th class="jikanwari-th">2時間目</th>
                    <th class="jikanwari-th">3時間目</th>
                    <th class="jikanwari-th">備考</th>
                    <th class="jikanwari-th">イベント</th>
                </tr>
            </thead>
            <tbody id="calendar-body">
                {% for date in dates_and_weekdays %}
                    {% set entry = existing_data.get(date.day, None) %}
                    <tr>
                        <td class="jikanwari-td">{{ selected_year }}</td>
                        <td class="jikanwari-td">{{ selected_month }}</td>
                        <td class="jikanwari-td">{{ date.day }}</td>
                        <td class="jikanwari-td">{{ date.weekday }}</td>
                        <td class="jikanwari-td">
                            <input type="text" name="period1_{{ date.day }}" 
                                   value="{{ entry.period1 if entry and entry.period1 else '' }}" 
                                   placeholder="1時間目">
                        </td>
                        <td class="jikanwari-td">
                            <input type="text" name="period2_{{ date.day }}" 
                                   value="{{ entry.period2 if entry else '' }}" 
                                   placeholder="2時間目">
                        </td>
                        <td class="jikanwari-td">
                            <input type="text" name="period3_{{ date.day }}" 
                                   value="{{ entry.period3 if entry else '' }}" 
                                   placeholder="3時間目">
                        </td>
                        <td class="jikanwari-td">
                            <input type="text" name="note_{{ date.day }}" 
                                   value="{{ entry.note if entry else '' }}" 
                                   placeholder="備考">
                        </td>
                        <td class="jikanwari-td">
                            <input type="text" name="event_{{ date.day }}" 
                                   value="{{ entry.event if entry else '' }}" 
                                   placeholder="イベント">
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <button type="submit">保存</button>
    </form>
{% endblock %}
